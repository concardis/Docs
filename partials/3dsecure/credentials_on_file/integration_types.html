
<ul>
  <li><a href="/3dsecure/credentials_on_file_integration_types#payengineCOFContract" name="">Payengine COF Contract</a></li>
  <li><a href="/3dsecure/credentials_on_file_integration_types#apis" name="">API</a></li>
    <ul>
      <li><a href="/3dsecure/credentials_on_file_integration_types#cardcheck">Card Check</a></li>
      <li><a href="/3dsecure/credentials_on_file_integration_types#order">Order</a></li>
    </ul>
    <li><a href="/3dsecure/credentials_on_file_integration_types#widgetSolutions">Widget Solutions</a></li>
    <ul>
      <li><a href="/3dsecure/credentials_on_file_integration_types#modalInlineWidgetValidations">Modal & Inline Widget Validations</a></li>
      <li><a href="/3dsecure/credentials_on_file_integration_types#widgetAsABridgeValidations">Widget As A Bridge Validations</a></li>
    </ul>
    <li><a href="/3dsecure/credentials_on_file_integration_types#jsBridge">JavaScript SDK (JS Bridge)</a></li>
</ul>

<div id="payengineCOFContract">
  <br/>
  <br/>
  <h2>Payengine COF Contract</h2>
    <br/>
    <p>Within the Payengine all credential-on-file related information will be assigned to an existing payment instrument of the corresponding card in the <em>cofContract</em> object.</p>
    <br/>
    <br/>
    <p>The cofContract object consists of the following parameters.</p>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <thead>
        <tr>
          <th width="230px">Parameter</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>id</td>
          <td>Unique identifier for the cofContract generated by the Payengine.</td>
        </tr>
        <tr>
          <td>type</td>
          <td>
            <p>The type of credential on file</p>
            <br/>
            <p>Supported values are: ONECLICK, UNSCHEDULED, SCHEDULED</p>
          </td>
        </tr>
        <tr>
          <td>channel</td>
          <td>
            <p>The channel (entry mode) via which the payment instrument and corresponding transactions should be used for.</p>
            <br/>
            <p>Supported values are: ECOM, MOTO</p>
            <br/>
            <p>Default value: ECOM</p>
        </tr>
      </tbody>
    </table>
    <br/>
    <p>The object can be passed either as part of a card check after payment credentials have been tokenized or as part of an order request, e.g. in the preauth or debit request.</p>
    <br/>
    <br/>
    <p>A card payment instrument in the Payengine could have multiple assigned <em>cofContracts</em>.</p>
    <br/>
    <p>The most typical use case would be that only one <em>cofContract</em> is assigned to a payment instrument. In this case the Payengine will automatically trace initial and subsequent transactions. For recurring payments the Payengine will also automatically extract the card scheme transaction identifier for the initial recurring payment and forward it as part of the subsequent transactions.</p>
    <br/>
    <p>In case a merchant would like to use the same payment instrument for multiple <em>cofContracts</em> the <em>id</em> would always be a required input parameter for each payment transaction!</p>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <tbody>
        <tr>
          <td style="border-right: none;" ><img class="" src="/img/3dsecure/exclamation.png" width="16px"></td>
          <td>Once a <em>cofContract</em> is assigned to a payment instrument it will always be returned together with other attributes of the payment instrument once queried (see sample below). </td>
        </tr>
      </tbody>
    </table>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <thead>
        <tr>
          <th>Payment Instrument Response</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <code>
                {
                  "paymentInstrumentId": "111",
                  "type": "creditcard",
                  ...
                  "attributes": {
                    "issuerCountry": "DE",
                    "expiryMonth": "12",
                    "cardHolder": "Max Mustermann",
                    "expiryYear": "30",
                    "brand": "MASTERCARD",
                    "cardNumber": "************0001",
                    "cofContracts": [
                      {
                        "id": "cofcontract_111",
                        "type": "UNSCHEDULED",
                        "channel": "ECOM"
                      }
                    ]
                  }
                  ...
                }
            </code>
          </td>
        </tr>
      </tbody>
    </table>
</div>
<br/>
<div id="apis">
  <br/>
  <h2>API</h2>
  <br/>
  <div id="cardcheck">
      <h3>Card Check</h3>
      <br/>
      <p>POST /payment-instruments/{paymentInstrumentId}/card-check</p>
      <br/>
      <p>Service to initiate a card check which will results in a 0,00â‚¬ authorization.</p>
      <br/>
      <ul>
        <li>If <em>cofContract</em> object is passed - the card check authorization will trigger an initial credential-on-file transaction, which can also be linked to a 3DS authentication. This option can be used in case the merchant only wants to stores the payment credentials and at this point no real payment should be initiated.</li>
        <li>If <em>cofContract</em> object is not passed (POST with empty request body) - a simple card check will be triggered with 0 amount via MOTO channel and will return the status of the card.</li>
      </ul>
      <p>Supported brands:</p>
      <ul>
        <li>Visa</li>
        <li>Mastercard</li>
        <li>AMEX</li>
        <li>JCB</li>
        <li>Diners/Discover</li>
      </ul>
      <br/>
      <table class="table table-bordered table-striped table-condensed">
          <thead>
            <tr>
              <th>Sample Cardcheck Request</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <code>
                  {
                    "threeDsAuthenticationId": "threedsauthentication_123",
                    "cofContract": {
                      "type": "UNSCHEDULED",
                      "channel": "ECOM"
                    }
                  }
                </code>
              </td>
            </tr>
          </tbody>
        </table>
        <br/>
        <table class="table table-bordered table-striped table-condensed">
          <thead>
            <tr>
              <th>Sample Card Check Response</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <code>
                    {
                      "id": "cardcheck_123",
                      "createdAt": 1561555495930,
                      "modifiedAt": 1561555495977,
                      "status": "SUCCESS",
                      "paymentInstrumentId": "paymentinstrument_111",
                      "threeDsAuthenticationId": "threedsauthentication_123",
                      "cofContract": {
                        "id": "cofcontract_123",
                        "type": "UNSCHEDULED",
                        "channel": "ECOM"
                      },
                      "errorDetails": {
                          "providerCode": null,
                          "providerMessage": null
                      }
                  }
                </code>
              </td>
            </tr>
          </tbody>
        </table>
    <br/>
    <p>The technical description of the service can be found <a href="https://docs.payengine.de//buildyourown/apidocs#operation/createCardcheckForPaymentInstrument" target="_blank">here</a>.</p>
  </div>
  <br/>
  <div id="order">
    <br/>
    <h3>Order</h3>
    <br/>
    <p>The <em>cofContract</em> information can be passed as part of the order request (preauth or debit).</p>
    <br/>
    <p>For initial transactions the type has to be provided.</p>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <thead>
        <tr>
          <th>Preauth/Debit Request (Initial COF)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <code>
                {
                  ...
                  "payment": {
                    ...
                    "paymentInstrumentId": "111",
                    "cofContract": {
                      "type": "ONECLICK"
                    }
                  }
                }
            </code>
          </td>
        </tr>
      </tbody>
    </table>
    <br/>
    <p>The Payengine will assign the <em>cofContract</em> to the payment instrument and log the usage including the required scheme identifiers returned for the initial transaction.</p>
    <br/>
    <p>Each <em>cofContract</em> will generate a unique Payengine identifier which is returned in the order response in the meta object.</p>
    <br/>
    <br/>
    <p>In case multiple <em>cofContract</em>  are assigned to a payment instrument a corresponding list will be returned as part of the paymentInstrument attributes.</p>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
        <thead>
          <tr>
            <th>Preauth/Debit Response</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <code>
                  {
                    ...
                    "paymentInstrument": {
                      "paymentInstrumentId": "111",
                      ...
                      "attributes": {
                        ...
                        "cofContracts": [
                          {
                            "id": "cofcontract_111",
                            "type": "UNSCHEDULED",
                            "channel": "ECOM"
                          },
                          {
                            "id": "cofcontract_222"
                            "type": "ONECLICK",
                            "channel": "ECOM"
                          }
                        ]
                      }
                    },
                    "meta": {
                      "cofContract": {
                          "id": "cofcontract_222",
                          "type": "ONECLICK",
                          "channel": "ECOM"
                      }
                    }
                    ...
                  }
              </code>
            </td>
          </tr>
        </tbody>
      </table>
      <br/>
      <br/>
      <p>Once a subsequent transaction will be initiated the id of the cofContract should be provided.</p>
      <table class="table table-bordered table-striped table-condensed">
          <thead>
            <tr>
              <th>Preauth/Debit Request (Subsequent COF)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <code>
                  {
                    ...
                    "payment": {
                      ...
                      "paymentInstrumentId": "111",
                      "cofContract": {
                        "id": "cofcontract_222"
                      }
                    }
                  }
                </code>
              </td>
            </tr>
          </tbody>
        </table>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <tbody>
        <tr>
          <td style="border-right: none;" ><img class="" src="/img/3dsecure/exclamation.png" width="16px"></td>
          <td>If there is only one <em>cofContract</em>  assigned to a payment instrument the Payengine can automatically extract the relevant data and on cofContract.id would be required as an input for subsequent transactions.</td>
        </tr>
      </tbody>
    </table>
    <br/>
    <p>The technical description of the service can be found <a href="https://docs.payengine.de/buildyourown/apidocs#tag%2FManage-orders" target="_blank">here</a>.</p>
  </div>
</div>
<br/>
<div id="widgetSolutions">
  <br/>
  <h2>Widget Solutions</h2>
  <br/>
  <p>Affected widget solutions:</p>
  <ul>
    <li>Modal Widget</li>
    <li>Inline Widget</li>
    <li>Widget as a Bridge</li>
  </ul>
  <br/>
  <p>In order to flag the credential-on-file usage in the Payengine widget solutions a new <em>cofContract.type</em> has to be provided as part of the <em>optionalFields</em>.</p>
  <br/>
  <p>Supported values:</p>
  <ul>
    <li>ONECLICK</li>
    <li>SCHEDULED</li>
    <li>UNSCHEDULED</li>
  </ul>
  <br/>
  <p><strong>Semple:</strong></p>
  <br/>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th>Preauth/Debit Request (Subsequent COF)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <code>
              var optionalParameters = {
                ...,
                "optionalFields": {
                  ...,
                  "creditCard": {
                    "cofContract": {
                      "type": "SCHEDULED"
                    }
                  }
                }
              };
               
              window.PayEngineWidget.initAsInlineComponentPi(
                'inline-widget-container',
                'Merchant-000cf2c9-66fe-4730-ac9e-674f7c552d42',
                optionalParameters,
                resultCallback
              );
          </code>
        </td>
      </tr>
    </tbody>
  </table>
  <br/>
  <p>Whenever a <em>cofContract.type</em> will be provided the widget will show a new additional checkbox to "Store payment data for future payments".</p>
  <br/>
  <p>This checkbox should be used by the cardholder to give his consent for storing the payment credentials for future payments.</p>
  <br/>
  <p>A sample from the Modal Widget can be found below.</p>
  <br/>
  <img class="" src="/img/3dsecure/payment_from_cc.png"/ width="30%">
  <br/>
  <br/>
  <br/>
  <table class="table table-bordered table-striped table-condensed">
    <tbody>
      <tr>
        <td style="border-right: none;" ><img class="" src="/img/3dsecure/error-triangle.png" width="16px"></td>
        <td>
          <p>The <em>cofContract.type</em> input is only used for the display of the corresponding checkbox in the widget. It is not stored with the payment instrument at this time.</p>
          <br/>
          <p>The <em>cofContract</em> still has to be assigned to the payment instrument either as part of the order request or as part of a card check.</p>
        </td>
      </tr>
    </tbody>
  </table>
  <br/>
  <div id="modalInlineWidgetValidations">
    <br/>
    <h3>Modal & Inline Widget Validations</h3>
    <br/>
    <p>For the Modal and Inline Widget the following validations will be done based on the checkbox.</p>
    <br/>
    <table class="table table-bordered table-striped table-condensed">
      <thead>
        <tr>
          <th width="230px">Type</th>
          <th>Checkbox Validation</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ONECLICK</td>
          <td>
            <p>If checkbox is checked - "ONECLICK" cofContract will be created and associated with the newly created payment instrument.</p>
            <br/>
            <p>If checkbox is NOT checked - no consent is given by the cardholder, the payment will be process as a ONETIME payment and credentials cannot be used again.</p>
          </td>
        </tr>
        <tr>
          <td>SCHEDULED</td>
          <td rowspan="2">
            <p>If checkbox is checked - "UNSCHEDULED"/"SCHEDULED" cofContract will be created and associated with the newly created payment instrument.</p>
            <br/>
            <p>If checkbox is NOT checked - the PAY button will be inactive.</p>
          </td>
        </tr>
        <tr>
          <td>UNSCHEDULED</td>
        </tr>
      </tbody>
    </table>
  </div>
  <br/>
  <div id="widgetAsABridgeValidations">
      <br/>
      <h3>Widget as a Bridge Validations</h3>
      <br/>
      <p>For the Widget as a bridget the following validations will be done based on the checkbox.</p>
      <br/>
      <table class="table table-bordered table-striped table-condensed">
        <thead>
          <tr>
            <th width="230px">Type</th>
            <th>Checkbox Validation</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ONECLICK</td>
            <td rowspan="3">
              <p>If checkbox is checked the checkout can proceed and the cofContract should be assigned to the payment instrument by the integrator either via card check or order</p>
              <br/>
              <p>If checkbox is NOT checked - the PAY button will be inactive. In case the integrator implemented an own button an error would be returned instead.</p>
            </td>
          </tr>
          <tr>
            <td>SCHEDULED</td>
          </tr>
          <tr>
            <td>UNSCHEDULED</td>
          </tr>
        </tbody>
      </table>
    </div>
    <br/>
</div>
<br/>
<div id="jsBridge">
  <br/>
  <h2>JavaScript SDK (JS Bridge)</h2>
  <br/>
  <p>A a new function <em>cardCheck(paymentInstrumentId, cofType, channel, authenticationId, callback)</em> that can be used by the integrator to assign the cofContract to a payment instrument and initiate a card check.</p>
  <br/>
  <p><strong>Input parameters:</strong></p>
  <table class="table table-bordered table-striped table-condensed">
    <thead>
      <tr>
        <th width="230px">Parameter</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>paymentInstrumentId</td>
        <td>
          <p>The identifier of the stored payment instrument.</p>
        </td>
      </tr>
      <tr>
        <td>cofType</td>
        <td>
          <p>The type of the cofContract.</p>
          <br/>
          <p>Supported values: SCHEDULED, UNSCHEDULED</p>
        </td>
      </tr>
      <tr>
        <td>channel</td>
        <td>
          <p>The channel (entry mode) via which the COF initial storage transaction is processed.</p>
          <br/>
          <p>Supported values: ECOM, MOTO</p>
        </td>
      </tr>
      <tr>
        <td>authenticationId</td>
        <td>
          <p>The 3DS authentication identifier obtained as result from threeDsAuthentication method call <br/>(in case a 3DS authentication was initiated before  and should be referenced in the cardcheck)</p>
        </td>
      </tr>
    </tbody>
  </table>
  <br/>
  <p><strong>Sample:</strong></p>
  <br/>
  <table class="table table-bordered table-striped table-condensed">
    <tbody>
      <tr>
        <td>
          <code>
              function callback(error, result) {...};
              var cofType = 'SCHEDULED';
              var channel = 'ECOM';
              window.PayEngine.cardCheck(paymentInstrumentId, cofType, channel, authenticationId, callback);
          </code>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<br/>
